<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Using PID to drive like Vin Diesel - boxmein</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I just finished the PID controller project of the Udacity Self-Driving Car Nanodegree!
https://www.youtube.com/watch?v=SrdFTXpXkR4
The challenge was simple - make this car go around the track, when the simulator will tell you how far off you are.
To do this, especially since the simulator tells us an error metric, I needed to build a PID controller.
A PID controller is a simple function that relates the error (how off we are from our trajectory) to a control variable (throttle/steering/&mldr;)."><meta property="og:image" content><meta property="og:title" content="Using PID to drive like Vin Diesel"><meta property="og:description" content="I just finished the PID controller project of the Udacity Self-Driving Car Nanodegree!
https://www.youtube.com/watch?v=SrdFTXpXkR4
The challenge was simple - make this car go around the track, when the simulator will tell you how far off you are.
To do this, especially since the simulator tells us an error metric, I needed to build a PID controller.
A PID controller is a simple function that relates the error (how off we are from our trajectory) to a control variable (throttle/steering/&mldr;)."><meta property="og:type" content="article"><meta property="og:url" content="https://boxmein.github.io/posts/2017-08-06-using-pid-to-drive-like-vin-diesel/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-08-06T00:00:00+00:00"><meta property="article:modified_time" content="2017-08-06T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using PID to drive like Vin Diesel"><meta name=twitter:description content="I just finished the PID controller project of the Udacity Self-Driving Car Nanodegree!
https://www.youtube.com/watch?v=SrdFTXpXkR4
The challenge was simple - make this car go around the track, when the simulator will tell you how far off you are.
To do this, especially since the simulator tells us an error metric, I needed to build a PID controller.
A PID controller is a simple function that relates the error (how off we are from our trajectory) to a control variable (throttle/steering/&mldr;)."><link href=https://boxmein.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://boxmein.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><script src=https://boxmein.github.io/posthog-tag.js></script></head><body><div class=content><header><div class=main><a href=https://boxmein.github.io/>boxmein</a></div><nav></nav></header><main><article><div class=title><h1 class=title>Using PID to drive like Vin Diesel</h1><div class=meta>Posted on Aug 6, 2017</div></div><section class=body><p>I just finished the PID controller project of the Udacity Self-Driving Car Nanodegree!</p><p><a href="https://www.youtube.com/watch?v=SrdFTXpXkR4">https://www.youtube.com/watch?v=SrdFTXpXkR4</a></p><p>The challenge was simple - make this car go around the track, when the simulator will tell you how far off you are.</p><p>To do this, especially since the simulator tells us an error metric, I needed to build a PID controller.</p><p>A PID controller is a simple function that relates the error (how off we are from our trajectory) to a control variable (throttle/steering/&mldr;).</p><p>Here is how it works:</p><p>$latex f(e) = - \tau_p \cdot e - \tau_i \cdot \sum e - \tau_d \cdot \frac{\delta e}{\delta t}$</p><p>To start off, the control variable should depend on the error with plain multiplication (<strong>proportion</strong>). This ensures the most basic requirement - the steering wheel&rsquo;s angle will depend on the error.</p><p>Secondly, the control variable should depend on all past errors combined. (<strong>integral</strong>). This ensures that when the car&rsquo;s steering system is imprecise, any persistent errors will be corrected.</p><p>Thirdly, the control variable should depend on the error&rsquo;s change over time. (<strong>derivative</strong>). This ensures that the steering wheel&rsquo;s correction smooths out the closer we get to zero error. This is a simple way to prevent over-correction and oscillation.</p><p>Together, their powers combined, they are captain Planet a PID controller.</p><p>The challenge now is to figure out what proportions to use - the different $latex \tau $ values.</p><p>To do this, an easy way we were taught in Udacity was <em>twiddle</em> (or coordinate ascent). Run the simulator, sum up the error over a few hundred cycles, then poke one of those taus up or down, and see if it brings the error down. It assumes that the three parameters will independently bring the whole run closer to optimal values.</p><p>In the case of this project, there&rsquo;s no easy way to trigger a run - its event oriented architecture meant that the code had to respond to upstream events. To still implement twiddle, I made the following changes architecturally:</p><ul><li>Keep track of Twiddle State (best error, sum-of-squares error for comparison, an &ldquo;enabled&rdquo; flag to keep throttle untwiddled, a step counter, and a &ldquo;state&rdquo; variable (what part of the loop should go next?) in the PID instance.</li><li>Implement the twiddle algorithm in the UpdateError() PID method</li><li>Run the twiddle algorithm only every [events] steps, but aggregate the error for all the steps</li><li>After twiddle runs, reset the summed error, CTE variables, set the step number to 1, and reset the simulator (by sending it a &ldquo;42[\&ldquo;reset\&rdquo;,{}]&rdquo;.)</li></ul><p>It took me about 450 runs to get to the parameters I used. A single run took around 5 seconds (300 telemetry events), then I upped it to 10 (1200 telemetry events), and then to 30 (2000 telemetry events). Note that during all that, the speed controller must stay the same - the parameters depend on the speed the car is moving.</p><p>This was a really fun project - implementing the optimization was interesting and very compelling. I had to think outside the box to come up with an architectural solution to fit twiddle in somewhere.</p><p><a href=https://github.com/boxmein/CarND-PID-Control-Project>Code is on GitHub</a></p><p>As a bonus for making it, here&rsquo;s a video of the PID controller crashing the car and going nuts:</p><p><a href=https://youtu.be/OwdC3O6RZc8>https://youtu.be/OwdC3O6RZc8</a></p></section><div class=post-tags></div></article></main><footer><div style=display:flex></div><div class=footer-info>2022 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>