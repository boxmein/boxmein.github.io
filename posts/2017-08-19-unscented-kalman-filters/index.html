<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Unscented Kalman Filters - boxmein</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This post is about the Unscented Kalman Filters project. Unscented Kalman Filters are like a Level 2 version of Extended Kalman Filters.
When my code (hopefully) passes review, I&rsquo;ve finished Term 2 of the Nanodegree. (I&rsquo;ve been pushing forward for 7 months even though it feels like I just applied to enter the Nanodegree!)
Here&rsquo;s a video of the Unscented Kalman Filter doing what it&rsquo;s supposed to.
The red and blue dots are noisy sensor data, while the green dots are the Kalman filter deciding the car is somewhere in the middle of the sensor data."><meta property="og:image" content><meta property="og:title" content="Unscented Kalman Filters"><meta property="og:description" content="This post is about the Unscented Kalman Filters project. Unscented Kalman Filters are like a Level 2 version of Extended Kalman Filters.
When my code (hopefully) passes review, I&rsquo;ve finished Term 2 of the Nanodegree. (I&rsquo;ve been pushing forward for 7 months even though it feels like I just applied to enter the Nanodegree!)
Here&rsquo;s a video of the Unscented Kalman Filter doing what it&rsquo;s supposed to.
The red and blue dots are noisy sensor data, while the green dots are the Kalman filter deciding the car is somewhere in the middle of the sensor data."><meta property="og:type" content="article"><meta property="og:url" content="https://boxmein.github.io/posts/2017-08-19-unscented-kalman-filters/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-08-19T00:00:00+00:00"><meta property="article:modified_time" content="2017-08-19T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Unscented Kalman Filters"><meta name=twitter:description content="This post is about the Unscented Kalman Filters project. Unscented Kalman Filters are like a Level 2 version of Extended Kalman Filters.
When my code (hopefully) passes review, I&rsquo;ve finished Term 2 of the Nanodegree. (I&rsquo;ve been pushing forward for 7 months even though it feels like I just applied to enter the Nanodegree!)
Here&rsquo;s a video of the Unscented Kalman Filter doing what it&rsquo;s supposed to.
The red and blue dots are noisy sensor data, while the green dots are the Kalman filter deciding the car is somewhere in the middle of the sensor data."><link href=https://boxmein.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://boxmein.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css><script src=https://boxmein.github.io/posthog-tag.js></script></head><body><div class=content><header><div class=main><a href=https://boxmein.github.io/>boxmein</a></div><nav></nav></header><main><article><div class=title><h1 class=title>Unscented Kalman Filters</h1><div class=meta>Posted on Aug 19, 2017</div></div><section class=body><p>This post is about the <a href=https://github.com/boxmein/CarND-Unscented-Kalman-Filter-Project>Unscented Kalman Filters project</a>. Unscented Kalman Filters are like a Level 2 version of <a href=https://wsdf294.wordpress.com/2017/06/04/using-extended-kalman-filters-for-object-tracking/>Extended Kalman Filters</a>.</p><p>When my code (hopefully) passes review, I&rsquo;ve finished Term 2 of the Nanodegree. (I&rsquo;ve been pushing forward for 7 months even though it feels like I just applied to enter the Nanodegree!)</p><p>Here&rsquo;s a video of the Unscented Kalman Filter doing what it&rsquo;s supposed to.</p><p>The red and blue dots are noisy sensor data, while the green dots are the Kalman filter deciding the car is somewhere in the middle of the sensor data.</p><p><a href="https://www.youtube.com/watch?v=nTTJY56KR1I">https://www.youtube.com/watch?v=nTTJY56KR1I</a></p><p> </p><h2 id=unscented-kalman-filter>Unscented Kalman Filter</h2><p>The <a href=https://en.wikipedia.org/wiki/Kalman_filter>Kalman Filter</a> is a method of estimating unknown variables, given imprecise measurements of those variables over time. It consists of witchcraft relating to Gaussian distributions, which results in finding truth from statistical noise.</p><p>In our assignment, we have to estimate the location of a car that is traveling in a figure-8 around the origin. In the simulator, there&rsquo;s a blue car spewing blue and red dots behind it - those are radar and lidar measurements, respectively.</p><p>We also know that the car&rsquo;s sensors aren&rsquo;t perfect, and we read the datasheets to find the errors of both sensors. For example, the lidar&rsquo;s error is +/- 15 cm on the X and Y axis. For the lidar, it&rsquo;s +/- 30cm for range, and +/- 0.3 rad for bearing. The Kalman filter will take those into account.</p><p>We&rsquo;ve already worked with Extended Kalman Filters, and the ugly hack with Jacobians to get the equations to fit into a linear mapping makes the EKF stink. The Unscented Kalman Filter has a better approach.</p><p><img src=images/screen-shot-2017-08-19-at-04-14-25.png alt="Screen Shot 2017-08-19 at 04.14.25.png"></p><h2 id=difference-with-ekf>Difference with EKF</h2><p>The UKF is actually a modification of the <a href=https://wsdf294.wordpress.com/2017/06/04/using-extended-kalman-filters-for-object-tracking/>Extended Kalman Filter</a>, with the property that it accepts nonlinear state space transformations. Instead of trying to linearize the transformation with approximations, we can approximate the Gaussian distribution by taking a number of samples around our last prediction and performing the rest of the Kalman filter according to their mean.</p><h2 id=summary>Summary</h2><p>The UKF project was the hardest of Term 2 for me. I finished the implementation before the soft deadline, but got stuck with a specific bug that froze the entire car after ~50 steps. With further digging for hours over the last few days, it turns out the state accumulates a really large turn rate. (To the tune of <em>2475671053860982691529977328824547267667523360841907602375247356361884070250956993566994344195776169297284982224684070269112727633920.0000</em>)</p><p>This in turn affects the yaw, which affects the angles used for X and Y coordinates.</p><p>Here&rsquo;s all the different bugs I had to fix before getting a sane result from the UKF.</p><p>When predicting the next state:</p><ul><li>Using the <strong>wrong $latex \sqrt{\lambda+n}$ expression</strong>: here $latex \lambda = -4$ and $latex n_{aug} = 7$, resulting in $latex \sqrt{3}$.</li><li>Forgetting to reset the <strong>Xsig_pred_</strong> to zeros.</li><li>Not noticing differences inside the <strong>offset calculations</strong> if $latex \dot{\psi} \approx 0$</li></ul><p>When updating states based on new measurements:</p><ul><li>Not <strong>normalizing the angle(s)</strong> when finding Lidar or Radar measurement covariance and cross-correlation matrix</li><li><strong>Subtracting instead of adding</strong> from P_.</li></ul><p>In the end, I had a lot of fun writing this. It was really satisfying to finally see my RMSE below the max allowed RMSE.</p><p>This concludes my Term 2 of the Nanodegree. I can&rsquo;t wait for Term 3!</p><p>Here&rsquo;s the <a href=https://github.com/boxmein/CarND-Unscented-Kalman-Filter-Project>source code.</a></p></section><div class=post-tags></div></article></main><footer><div style=display:flex></div><div class=footer-info>2022 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>